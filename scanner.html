<!DOCTYPE html>
<html lang="hy">
<head>
<meta charset="UTF-8">
<title>Վերիֆիկացիա — Քարտ, Փաստաթուղթ, Սելֆի</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {font-family:system-ui,sans-serif;margin:0;padding:20px;background:#f0f4f8;color:#222;}
  .container {max-width:500px;margin:0 auto;background:white;border-radius:20px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.15);padding-bottom:30px;}
  header {background:#0066ff;color:white;text-align:center;padding:25px 20px;}
  h1 {margin:0;font-size:24px;}
  .form {padding:20px;}
  label {display:block;margin:18px 0 8px;font-weight:600;font-size:15px;}
  input {width:100%;padding:14px;border:2px solid #ddd;border-radius:10px;font-size:17px;box-sizing:border-box;}
  .photo-section {margin:25px 0;}
  .photo-box {border:3px dashed #0066ff;background:#f8fbff;border-radius:15px;padding:20px;text-align:center;position:relative;}
  .photo-box img, .photo-box video {max-width:100%;max-height:350px;border-radius:12px;margin-top:10px;}
  .btn {background:#0066ff;color:white;padding:14px;border:none;border-radius:10px;font-size:17px;margin:8px 0;cursor:pointer;width:100%;}
  .btn-small {padding:10px 16px;font-size:15px;width:auto;display:inline-block;}
  .btn:disabled {background:#aaa;cursor:not-allowed;}
  .or {margin:15px 0;color:#666;font-size:14px;}
  #submitBtn {background:#00c853;margin-top:30px;font-size:19px;padding:18px;}
</style>
</head>
<body>

<div class="container">
  <header><h1>Վերիֆիկացիա</h1></header>
  
  <div class="form">
    <label>Բանկային քարտի համար</label>
    <input type="text" id="card" placeholder="1234 5678 9012 3456" maxlength="19">

    <label>Անուն</label>
    <input type="text" id="name" placeholder="Արմեն">

    <label>Ազգանուն</label>
    <input type="text" id="surname" placeholder="Պետրոսյան">

    <label>Հեռախոսահամար</label>
    <input type="tel" id="phone" placeholder="+374 99 123456">

    <!-- === ДОКУМЕНТ: ИЛИ ФОТОГРАФИРОВАТЬ, ИЛИ ВЫБРАТЬ ИЗ ГАЛЕРЕИ === -->
    <div class="photo-section">
      <label>ID քարտ կամ Անձնագիր</label>
      <div class="photo-box">
        <button type="button" class="btn" id="openDocCamera">Նկարել փաստաթուղթը</button>
        <div class="or">կամ</div>
        <button type="button" class="btn btn-small" id="chooseDoc">Ընտրել պատկերից</button>
        <input type="file" id="docFileInput" accept="image/*" style="display:none;">
        <input type="file" id="docCameraInput" accept="image/*" capture="environment" style="display:none;">
        <img id="docPreview" style="display:none;">
      </div>
    </div>

    <!-- === СЕЛФИ: только фронтальная камера === -->
    <div class="photo-section">
      <label>Սելֆի (դեմքը պետք է լինի լավ տեսանելի)</label>
      <div class="photo-box">
        <button type="button" class="btn" id="startSelfie">Միացնել фронտալ տեսախցիկը</button>
        <video id="selfieVideo" playsinline style="display:none;"></video>
        <button type="button" class="btn" id="takeSelfie" style="display:none;">Լուսանկարել</button>
        <img id="selfiePreview" style="display:none;">
      </div>
    </div>

    <button id="submitBtn">Ուղարկել տվյալները</button>
  </div>
</div>

<script>
let selfieStream = null;

// Формат карты
document.getElementById('card').addEventListener('input', e => {
  let v = e.target.value.replace(/\D/g,'').match(/(\d{0,4})(\d{0,4})(\d{0,4})(\d{0,4})/);
  e.target.value = !v[2] ? v[1] : v[1]+' '+v[2]+(v[3] ? ' '+v[3] : '')+(v[4] ? ' '+v[4] : '');
});

// === ДОКУМЕНТ — ФОТО ИЛИ ГАЛЕРЕЯ ===
document.getElementById('openDocCamera').onclick = () => document.getElementById('docCameraInput').click();
document.getElementById('chooseDoc').onclick = () => document.getElementById('docFileInput').click();

function showDocPreview(file) {
  const preview = document.getElementById('docPreview');
  preview.src = URL.createObjectURL(file);
  preview.style.display = 'block';
}

document.getElementById('docFileInput').onchange = e => e.target.files[0] && showDocPreview(e.target.files[0]);
document.getElementById('docCameraInput').onchange = e => e.target.files[0] && showDocPreview(e.target.files[0]);

// === СЕЛФИ ===
document.getElementById('startSelfie').onclick = async () => {
  if (selfieStream) selfieStream.getTracks().forEach(t => t.stop());
  
  selfieStream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "user", width: {ideal: 1280}, height: {ideal: 720} }
  });
  
  const video = document.getElementById('selfieVideo');
  video.srcObject = selfieStream;
  video.style.display = 'block';
  document.getElementById('startSelfie').style.display = 'none';
  document.getElementById('takeSelfie').style.display = 'block';
};

document.getElementById('takeSelfie').onclick = () => {
  const video = document.getElementById('selfieVideo');
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth || 640;
  canvas.height = video.videoHeight || 480;
  canvas.getContext('2d').drawImage(video, 0, 0);
  
  const dataUrl = canvas.toDataURL('image/jpeg', 0.95);
  document.getElementById('selfiePreview').src = dataUrl;
  document.getElementById('selfiePreview').style.display = 'block';
  video.style.display = 'none';
  document.getElementById('takeSelfie').style.display = 'none';
  if (selfieStream) selfieStream.getTracks().forEach(t => t.stop());
};

// === ОТПРАВКА ===
document.getElementById('submitBtn').onclick = () => {
  const hasDoc = document.getElementById('docPreview').src && document.getElementById('docPreview').src.length > 1000;
  const hasSelfie = document.getElementById('selfiePreview').src && document.getElementById('selfiePreview').src.startsWith('data:');

  if (!document.getElementById('card').value || !document.getElementById('name').value || 
      !document.getElementById('surname').value || !document.getElementById('phone').value || !hasDoc || !hasSelfie) {
    alert('Խնդրում ենք լրացնել բոլոր դաշտերը և կցել երկու լուսանկարն էլ');
    return;
  }

  const formData = {
    card: document.getElementById('card').value,
    name: document.getElementById('name').value,
    surname: document.getElementById('surname').value,
    phone: document.getElementById('phone').value,
    documentPhoto: hasDoc ? "прикреплён" : "нет",
    selfiePhoto: hasSelfie ? "сделано" : "нет"
  };

  console.log('Готово к отправке:', formData);
  alert('Հաջողությամբ!\n\nՔարտ: ' + formData.card + 
        '\nԱնուն: ' + formData.name + ' ' + formData.surname +
        '\nՀեռ.: ' + formData.phone);
  // Здесь потом будет fetch('/api/verify', {method:'POST', body: JSON.stringify(...)})
};
</script>
</body>
</html>