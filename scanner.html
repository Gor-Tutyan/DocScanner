<!DOCTYPE html>
<html lang="hy">
<head>
<meta charset="UTF-8">
<title>Վերիֆիկացիա</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {font-family:system-ui,sans-serif;margin:0;padding:20px;background:#f0f4f8;color:#222;}
  .card {max-width:500px;margin:0 auto;background:white;border-radius:20px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.15);}
  header {background:#0066ff;color:white;text-align:center;padding:30px 20px;}
  h1 {margin:0;font-size:24px;}
  .form {padding:25px;}
  label {display:block;margin:20px 0 8px;font-weight:600;font-size:16px;}
  input {width:100%;padding:15px;border:2px solid #ddd;border-radius:12px;font-size:17px;box-sizing:border-box;}
  .photo-box {border:3px dashed #0066ff;background:#f8fbff;border-radius:16px;padding:30px;text-align:center;margin:30px 0;}
  .photo-box img, .photo-box video {max-width:100%;max-height:360px;border-radius:12px;margin-top:15px;display:block;}
  .btn {background:#0066ff;color:white;padding:16px;border:none;border-radius:12px;font-size:18px;margin:10px 0;cursor:pointer;width:100%;font-weight:600;}
  #submitBtn {background:#00c853;font-size:20px;padding:20px;margin-top:40px;}
  .status {font-size:14px;color:#666;margin-top:10px;}
</style>
</head>
<body>

<div class="card">
  <header><h1>Վերիֆիկացիա</h1></header>
  
  <div class="form">
    <label>Բանկային քարտի համար</label>
    <input type="text" id="card" placeholder="1234 5678 9012 3456" maxlength="19">

    <label>Անուն</label>
    <input type="text" id="name" placeholder="Արմեն">

    <label>Ազգանուն</label>
    <input type="text" id="surname" placeholder="Պետրոսյան">

    <label>Հեռախոսահամար</label>
    <input type="tel" id="phone" placeholder="+374 99 123456">

    <!-- ДОКУМЕНТ — только выбор из галереи -->
    <div class="photo-box">
      <div style="font-weight:600;margin-bottom:15px;">ID քարտ կամ Անձնագիր</div>
      <button type="button" class="btn" id="chooseDoc">Ընտրել փաստաթուղթը</button>
      <input type="file" id="docInput" accept="image/*" style="display:none;">
      <img id="docPreview" style="display:none;">
      <div class="status" id="docStatus">Դեռ չի ընտրվել</div>
    </div>

    <!-- СЕЛФИ — только фото с фронтальной камеры -->
    <div class="photo-box">
      <div style="font-weight:600;margin-bottom:15px;">Սելֆի (դեմքը պետք է լինի լավ տեսանելի)</div>
      <button type="button" class="btn" id="startSelfie">Սելֆի անել</button>
      <video id="selfieVideo" playsinline style="display:none;"></video>
      <button type="button" class="btn" id="takeSelfie" style="display:none;">Լուսանկարել</button>
      <img id="selfiePreview" style="display:none;">
      <div class="status" id="selfieStatus">Դեռ չի արվել</div>
    </div>

    <button id="submitBtn">Ուղարկել տվյալները</button>
  </div>
</div>

<script>
let selfieStream = null;

// Формат карты
document.getElementById('card').addEventListener('input', e => {
  let v = e.target.value.replace(/\D/g,'').match(/(\d{0,4})(\d{0,4})(\d{0,4})(\d{0,4})/);
  e.target.value = !v[2] ? v[1] : v[1]+' '+v[2]+(v[3] ? ' '+v[3] : '')+(v[4] ? ' '+v[4] : '');
});

// === ДОКУМЕНТ — только выбор из галереи ===
document.getElementById('chooseDoc').onclick = () => document.getElementById('docInput').click();

document.getElementById('docInput').onchange = e => {
  const file = e.target.files[0];
  if (file) {
    const url = URL.createObjectURL(file);
    document.getElementById('docPreview').src = url;
    document.getElementById('docPreview').style.display = 'block';
    document.getElementById('docStatus').textContent = 'Ընտրված է';
    document.getElementById('docStatus').style.color = '#00c853';
  }
};

// === СЕЛФИ — только фронтальная камера ===
document.getElementById('startSelfie').onclick = async () => {
  if (selfieStream) selfieStream.getTracks().forEach(t => t.stop());
  
  try {
    selfieStream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "user", width: {ideal: 1280}, height: {ideal: 720} }
    });
    
    const video = document.getElementById('selfieVideo');
    video.srcObject = selfieStream;
    video.style.display = 'block';
    document.getElementById('startSelfie').style.display = 'none';
    document.getElementById('takeSelfie').style.display = 'block';
  } catch (err) {
    alert('Չհաջողվեց միացնել տեսախցիկը');
  }
};

document.getElementById('takeSelfie').onclick = () => {
  const video = document.getElementById('selfieVideo');
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth || 640;
  canvas.height = video.videoHeight || 480;
  canvas.getContext('2d').drawImage(video, 0, 0);
  
  const dataUrl = canvas.toDataURL('image/jpeg', 0.95);
  document.getElementById('selfiePreview').src = dataUrl;
  document.getElementById('selfiePreview').style.display = 'block';
  
  video.style.display = 'none';
  document.getElementById('takeSelfie').style.display = 'none';
  document.getElementById('startSelfie').textContent = 'Կրկին սելֆի';
  document.getElementById('startSelfie').style.display = 'block';
  
  document.getElementById('selfieStatus').textContent = 'Արված է';
  document.getElementById('selfieStatus').style.color = '#00c853';
  
  if (selfieStream) {
    selfieStream.getTracks().forEach(t => t.stop());
    selfieStream = null;
  }
};

// === ОТПРАВКА ===
document.getElementById('submitBtn').onclick = () => {
  const fields = {
    card: document.getElementById('card').value.trim(),
    name: document.getElementById('name').value.trim(),
    surname: document.getElementById('surname').value.trim(),
    phone: document.getElementById('phone').value.trim()
  };

  const hasDoc = document.getElementById('docPreview').style.display === 'block';
  const hasSelfie = document.getElementById('selfiePreview').style.display === 'block';

  if (Object.values(fields).some(v => !v) || !hasDoc || !hasSelfie) {
    alert('Խնդրում ենք լրացնել բոլոր դաշտերը, ընտրել փաստաթուղթը և անել սելֆի');
    return;
  }

  alert('Հաջողությամբ!\n\nՏվյալները պատրաստ են ուղարկման');
  console.log('Готово к отправке:', fields);
  // fetch('/api/submit', { method: 'POST', body: JSON.stringify(fields) })
};
</script>
</body>
</html>