<!DOCTYPE html>
<html lang="hy">
<head>
<meta charset="UTF-8">
<title>Վերիֆիկացիա</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {font-family:system-ui,sans-serif;margin:0;padding:20px;background:#f0f4f8;color:#222;}
  .card {max-width:500px;margin:0 auto;background:white;border-radius:20px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.15);}
  header {background:#0066ff;color:white;text-align:center;padding:30px 20px;}
  h1 {margin:0;font-size:24px;}
  .form {padding:25px;}
  label {display:block;margin:20px 0 8px;font-weight:600;font-size:16px;}
  input {width:100%;padding:15px;border:2px solid #ddd;border-radius:12px;font-size:17px;box-sizing:border-box;transition:border 0.3s;}
  input.invalid {border-color:#ff4444 !important;}
  .error {color:#ff4444;font-size:14px;margin-top:5px;height:20px;}
  .photo-box {border:3px dashed #0066ff;background:#f8fbff;border-radius:16px;padding:30px;text-align:center;margin:30px 0;position:relative;}
  .photo-box.required::after {content:"*";color:red;font-size:20px;position:absolute;top:10px;right:15px;}
  .photo-box img {max-width:100%;max-height:360px;border-radius:12px;margin-top:15px;display:block;}
  .btn {background:#0066ff;color:white;padding:16px;border:none;border-radius:12px;font-size:18px;margin:10px 0;cursor:pointer;width:100%;font-weight:600;}
  #submitBtn {background:#ccc;color:#666;font-size:20px;padding:20px;margin-top:40px;cursor:not-allowed;}
  #submitBtn.active {background:#00c853;color:white;cursor:pointer;}
  .status {font-size:14px;margin-top:10px;}
  .status.ok {color:#00c853;}
  .status.error {color:#ff4444;}
</style>
</head>
<body>

<div class="card">
  <header><h1>Վերիֆիկացիա</h1></header>
  
  <div class="form">
    <label>Բանկային քարտի համար <span style="color:red">*</span></label>
    <input type="text" id="card" placeholder="1234 5678 9012 3456" maxlength="19">
    <div class="error" id="cardError"></div>

    <label>Անուն <span style="color:red">*</span></label>
    <input type="text" id="name" placeholder="Արմեն">

    <label>Ազգանուն <span style="color:red">*</span></label>
    <input type="text" id="surname" placeholder="Պետրոսյան">

    <label>Հեռախոսահամար <span style="color:red">*</span></label>
    <input type="tel" id="phone" value="+374 ">

    <!-- ДОКУМЕНТ — ОБЯЗАТЕЛЬНО -->
    <div class="photo-box required">
      <div style="font-weight:600;margin-bottom:15px;">ID քարտ կամ Անձնագիր</div>
      <button type="button" class="btn" id="chooseDoc">Ընտրել փաստաթուղթը</button>
      <input type="file" id="docFile" accept="image/*" style="display:none;">
      <img id="docImg" style="display:none;">
      <div class="status" id="docStatus">Պարտադիր է</div>
    </div>

    <!-- СЕЛФИ — ОБЯЗАТЕЛЬНО -->
    <div class="photo-box required">
      <div style="font-weight:600;margin-bottom:15px;">Սելֆի</div>
      <button type="button" class="btn" id="takeSelfie">Սելֆի անել</button>
      <input type="file" id="selfieCam" accept="image/*" capture="user" style="display:none;">
      <img id="selfieImg" style="display:none;">
      <div class="status" id="selfieStatus">Պարտադիր է</div>
    </div>

    <button id="submitBtn" disabled>Ուղարկել</button>
  </div>
</div>

<script>
// +374 нельзя стереть
const phoneInput = document.getElementById('phone');
phoneInput.addEventListener('input', () => {
  if (!phoneInput.value.startsWith('+374 ')) {
    phoneInput.value = '+374 ' + phoneInput.value.replace(/^\+374\s*/, '');
  }
});
phoneInput.addEventListener('keydown', e => {
  if ((e.key === 'Backspace' || e.key === 'Delete') && phoneInput.selectionStart <= 5) e.preventDefault();
});

// Формат карты + проверка Луна
document.getElementById('card').addEventListener('input', e => {
  let v = e.target.value.replace(/\D/g,'').substring(0,16);
  v = v.match(/.{1,4}/g)?.join(' ') || v;
  e.target.value = v;
  validateForm();
});

function luhnCheck(num) {
  const d = num.replace(/\D/g,'').split('').map(Number);
  if (d.length < 13) return false;
  let s = 0, even = false;
  for (let i = d.length - 1; i >= 0; i--) {
    let digit = d[i];
    if (even) { digit *= 2; if (digit > 9) digit -= 9; }
    s += digit;
    even = !even;
  }
  return s % 10 === 0;
}

// Полная валидация
function validateForm() {
  const card = document.getElementById('card').value;
  const name = document.getElementById('name').value.trim();
  const surname = document.getElementById('surname').value.trim();
  const phone = document.getElementById('phone').value;
  const docOk = document.getElementById('docImg').style.display === 'block';
  const selfieOk = document.getElementById('selfieImg').style.display === 'block';

  const cardClean = card.replace(/\s/g,'');
  const cardFull = card.length === 19;
  const cardValid = cardFull && luhnCheck(card);
  const phoneValid = /^\+374 \d{8}$/.test(phone);

  // Карта
  if (cardFull && !cardValid) {
    document.getElementById('cardError').textContent = 'Սխալ քարտի համար';
    document.getElementById('card').classList.add('invalid');
  } else {
    document.getElementById('cardError').textContent = '';
    document.getElementById('card').classList.remove('invalid');
  }

  // Статусы фото
  document.getElementById('docStatus').textContent = docOk ? 'Ընտրված է' : 'Պարտադիր է';
  document.getElementById('docStatus').className = 'status ' + (docOk ? 'ok' : 'error');
  document.getElementById('selfieStatus').textContent = selfieOk ? 'Արված է' : 'Պարտադիր է';
  document.getElementById('selfieStatus').className = 'status ' + (selfieOk ? 'ok' : 'error');

  // Кнопка
  const allOk = cardValid && name && surname && phoneValid && docOk && selfieOk;
  document.getElementById('submitBtn').disabled = !allOk;
  document.getElementById('submitBtn').classList.toggle('active', allOk);
}

// Запуск валидации при любом изменении
['card','name','surname','phone'].forEach(id => {
  document.getElementById(id).addEventListener('input', validateForm);
});

// Документ
document.getElementById('chooseDoc').onclick = () => document.getElementById('docFile').click();
document.getElementById('docFile').onchange = e => {
  if (e.target.files[0]) {
    document.getElementById('docImg').src = URL.createObjectURL(e.target.files[0]);
    document.getElementById('docImg').style.display = 'block';
    validateForm();
  }
};

// Селфи
document.getElementById('takeSelfie').onclick = () => document.getElementById('selfieCam').click();
document.getElementById('selfieCam').onchange = e => {
  if (e.target.files[0]) {
    document.getElementById('selfieImg').src = URL.createObjectURL(e.target.files[0]);
    document.getElementById('selfieImg').style.display = 'block';
    validateForm();
  }
};

// Отправка
document.getElementById('submitBtn').onclick = () => {
  if (document.getElementById('submitBtn').disabled) return;
  alert('Հաջողությամբ ուղարկվեց! ✅');
  console.log('Все